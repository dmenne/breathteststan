image: dmenne/stanverse
test:
  script:
    - mkdir -p ~/.R
    - echo "CXX14FLAGS=-O3 -mtune=native -march=native -Wno-unused-variable -Wno-unused-function  -Wno-macro-redefined" >> ~/.R/Makevars
    - echo "CXX14=g++ -std=c++1y -fPIC" >> ~/.R/Makevars
    - Rscript -e 'devtools::install_github("dmenne/breathtestcore")'
    - R CMD build . --no-build-vignettes --no-manual
    - PKG_FILE_NAME=$(ls -1t *.tar.gz | head -n 1)
    - R CMD check "${PKG_FILE_NAME}" --no-build-vignettes --no-manual --as-cran

after_script:
  - Rscript -e 'covr::coveralls(line_exclusions="src/init.cpp", repo_token = "n676HjXu9pW0EFLdlgCWZFOSm7MeirZOQ")'
